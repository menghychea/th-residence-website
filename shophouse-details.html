<!DOCTYPE html>
<html lang="en" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TH Residence - Shophouse Details</title>
    <!-- Tailwind CSS CDN link -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts CDN link -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN link (corrected integrity attribute) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- AOS CSS CDN link -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Pannellum CSS for 360 viewer -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
  
    <style>
        /* Base styles for body */
        body {
            padding-top: 64px; /* Adjust this value if header height changes */
            scroll-padding-top: 64px; /* Ensures content isn't hidden by the fixed header when scrolling to an ID */
            overflow-x: hidden; /* Prevent horizontal scroll for the main body */
            font-family: 'Inter', sans-serif; /* Ensure Inter font is applied */
            background-color: #f3f4f6; /* Fallback background color */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            z-index: 0;
        }

        /* Full page background image with blur */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('Image/MASTER PLAN.jpg'); /* Your local background image */
            background-size: cover;
            background-position: center;
            filter: blur(2px); /* Maintain original blur amount */
            z-index: -1;
        }

        /* Reusing common styles from shophouse.css for consistency */
        .section-padding {
            padding-top: 4rem; /* py-16 */
            padding-bottom: 4rem; /* py-16 */
        }
        .image-caption {
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* text-gray-600 */
        }
        .plan-image-container, .interior-image-container {
            border-radius: 0.5rem; /* rounded-lg */
            overflow: hidden; /* Ensures image fits */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
        }
        .plan-image-container img, .interior-image-container img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 0.25rem; /* rounded */
            cursor: pointer; /* Indicate clickable */
            transition: transform 0.2s ease-in-out; /* For hover effect */
        }
        .plan-image-container img:hover, .interior-image-container img:hover {
            transform: scale(1.02); /* Slight zoom on hover */
        }

        /* Modal Styles (reused from shophouse details) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 0.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            transform: scale(0.8);
            transition: transform 0.3s ease-in-out;
        }
        .modal-overlay.open .modal-content {
            transform: scale(1);
        }
        body.modal-open {
            overflow: hidden;
        }
        .modal-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1010;
            transition: background-color 0.3s ease;
        }
        .modal-nav-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .modal-nav-button.left {
            left: 1rem;
        }
        .modal-nav-button.right {
            right: 1rem;
        }
        .modal-nav-button.hidden {
            display: none;
        }

        /* Carousel specific styles (reused from shophouse details) */
        .carousel-container {
            position: relative;
            width: 100%;
            height: 300px; /* Default for small screens */
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .carousel-container {
                height: 400px;
            }
        }
        @media (min-width: 768px) { /* md breakpoint */
            .carousel-container {
                height: 500px;
            }
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .carousel-container {
                height: 600px;
            }
        }
        .carousel-inner {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 100%;
        }
        .carousel-slide {
            flex: 0 0 100%;
            height: 100%;
            object-fit: cover;
        }
        .carousel-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 0.75rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .carousel-nav-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .carousel-nav-button.left {
            left: 1rem;
        }
        .carousel-nav-button.right {
            right: 1rem;
        }
        .carousel-indicators {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        .carousel-indicators .indicator-dot {
            width: 10px;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .carousel-indicators .indicator-dot.active {
            background-color: white;
        }

           /* 360 Viewer specific styles */
        #panorama-viewer {
            width: 100%;
            height: 500px; /* Adjust height as needed */
            border-radius: 0.75rem; /* Matches rounded-xl Tailwind class */
            overflow: hidden; /* Ensures content respects border-radius */
        }
        /* Floor Plans Grid Centering */
        .floor-plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjust minmax as needed */
            gap: 1.5rem; /* gap-6 from Tailwind */
            justify-items: center; /* Centers items within their grid cells */
            justify-content: center; /* Centers the grid itself if there's extra space */
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-white shadow-md p-4 w-full fixed top-0 left-0 z-50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
            <div class="text-2xl font-bold text-gray-800 mb-4 md:mb-0 flex items-center">
                <!-- Company Logo -->
                <img src="Image/profile.jpg" alt="Company Logo" class="w-8 h-8 rounded-full object-cover mr-2">
                <a href="./" class="hover:text-blue-600 transition duration-300 ease-in-out"> TH RESIDENCE </a>
            </div>

            <!-- Hamburger Menu Button (visible on small screens) -->
            <button id="mobile-menu-button" class="md:hidden text-gray-700 hover:text-[#7E252C] focus:outline-none focus:ring-2 focus:ring-blue-500 p-2 rounded-md absolute top-4 right-4">
                <i class="fa-solid fa-bars text-2xl"></i>
            </button>

            <nav id="main-navigation" class="hidden md:block w-full md:w-auto mt-4 md:mt-0">
                <!-- Close button for mobile menu -->
                <button id="mobile-menu-close-button" class="md:hidden absolute top-4 right-4 text-gray-700 hover:text-[#7E252C] focus:outline-none focus:ring-2 focus:ring-blue-500 p-2 rounded-md">
                    <i class="fa-solid fa-times text-2xl"></i>
                </button>
                <ul class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-8 text-lg font-medium text-center md:text-left">
                    <li>
                        <a href="index.html" class="block text-gray-700 hover:text-[#7E252C] transition duration-300 ease-in-out rounded-md p-2 -m-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Home page</a>
                    </li>
                    <li>
                        <a href="index.html#properties-section" class="block text-gray-700 hover:text-[#7E252C] transition duration-300 ease-in-out rounded-md p-2 -m-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Properties</a>
                    </li>
                    <li>
                        <a href="index.html#about-us-section" class="block text-gray-700 hover:text-[#7E252C] transition duration-300 ease-in-out rounded-md p-2 -m-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">About Us</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="flex-grow w-full py-8 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4">

            <section class="rounded-lg p-6 mb-12 text-center bg-white shadow-lg">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">SHOPHOUSE / ផ្ទះអាជីវកម្ម</h1>
                
                <!-- Land Size and House Size (Placeholder values) -->
                <div class="flex flex-col md:flex-row justify-center items-center space-y-2 md:space-y-0 md:space-x-8 text-gray-700 text-lg font-medium mb-6">
                    <span class="whitespace-nowrap">ទំហំដី | Land Size: <span class="font-bold">5m x 20m</span></span>
                    <span class="whitespace-nowrap">ទំហំផ្ទះ | House Size: <span class="font-bold">5m x 12m</span></span>
                </div>
                
                <!-- Shophouse Main Image Carousel -->
                <div class="carousel-container mb-8">
                    <div id="linkhouse-carousel" class="carousel-inner">
                        <!-- Slides will be injected by JavaScript -->
                    </div>
                    <!-- Carousel Navigation Buttons -->
                    <button id="linkhouse-prev" class="carousel-nav-button left">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                    <button id="linkhouse-next" class="carousel-nav-button right">
                        <i class="fa-solid fa-chevron-right"></i>
                    </button>
                    <!-- Carousel Indicators -->
                    <div id="linkhouse-indicators" class="carousel-indicators">
                        <!-- Indicators will be injected by JavaScript -->
                    </div>
                </div>
                <!-- End Shophouse Main Image Carousel -->
                
                <a href="https://momento360.com/e/uc/YOUR_SHOPHOUSE_3D_MODEL_ID?utm_campaign=embed&utm_source=other&size=medium&display-plan=true" target="_blank" class="inline-block bg-[#7E252C] text-white py-3 px-8 rounded-md hover:bg-red-800 transition duration-300 ease-in-out text-xl font-semibold shadow-lg mt-4">View 3D Model</a>
            </section>

            <section class="mb-12 px-4 py-16 bg-gray-50 rounded-lg shadow-inner mt-8" data-aos="fade-up" data-aos-duration="1000">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Floor Plans / ប្លង់ផ្ទះ</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="plan-image-container p-4">
                        <img src="Image/B_GFloor.png" alt="Shophouse Ground Floor Plan" class="clickable-image" data-group="shophouse-floorplans" data-fullsrc="Image/B_GFloor.png">
                        <p class="image-caption text-center mt-2">GROUND FLOOR</p>
                    </div>
                    <div class="plan-image-container p-4">
                        <img src="Image/B_1Floor.png" alt="Shophouse 1st Floor Plan" class="clickable-image" data-group="shophouse-floorplans" data-fullsrc="Image/B_1Floor.png">
                        <p class="image-caption text-center mt-2">1ST FLOOR</p>
                    </div>
                    <div class="plan-image-container p-4">
                        <img src="Image/B_2Floor.png" alt="Shophouse 2nd Floor Plan" class="clickable-image" data-group="shophouse-floorplans" data-fullsrc="Image/B_2Floor.png">
                        <p class="image-caption text-center mt-2">2ND FLOOR</p>
                    </div>
                </div>
            </section>

            <section class="mb-12 px-4 py-16 bg-white rounded-lg shadow-lg mt-8" data-aos="fade-up" data-aos-duration="1000">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Interior Spaces / បរិយាកាសខាងក្នុង</h2>
                
                <!-- Features (Bedroom, Bathroom, Storage) -->
                <div class="flex flex-col sm:flex-row justify-center items-center gap-x-8 gap-y-4 text-gray-700 text-lg mb-8">
                    <div class="flex items-center">
                        <i class="fa-solid fa-bed w-5 h-5 mr-2 text-gray-500"></i>
                        <span>បន្ទប់គេង | Bedroom: <span class="font-bold">5</span></span>
                    </div>
                    <div class="flex items-center">
                        <i class="fa-solid fa-bath w-5 h-5 mr-2 text-gray-500"></i>
                        <span>បន្ទប់ទឹក | Bathroom: <span class="font-bold">6</span></span>
                    </div>
                </div>

                <!-- Interior Spaces Grid -->
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                    <div class="interior-image-container p-4">
                        <img src="Image/B-LIVING ROOM-1.jpg" alt="Shophouse Living Room" class="clickable-image" data-group="shophouse-interior-all" data-fullsrc="Image/B-LIVING ROOM-1.jpg">
                        <p class="image-caption text-center mt-2">បន្ទប់ទទួលភ្ញៀវ | LIVINGROOM</p>
                    </div>
                    <div class="interior-image-container p-4">
                        <img src="Image/B-KITCHEN-1.jpg" alt="Shophouse Kitchen" class="clickable-image" data-group="shophouse-interior-all" data-fullsrc="Image/B-KITCHEN-1.jpg">
                        <p class="image-caption text-center mt-2">ផ្ទះបាយ | KITCHEN</p>
                    </div>
                    <div class="interior-image-container p-4">
                        <img src="Image/B-MASTER BEDROOM-3.png" alt="Shophouse Master Bedroom" class="clickable-image" data-group="shophouse-interior-all" data-fullsrc="Image/B-MASTER BEDROOM-3.png">
                        <p class="image-caption text-center mt-2">បន្ទប់គេងធំ | MASTER BEDROOM</p>
                    </div>
                    <div class="interior-image-container p-4">
                        <img src="Image/B-HOME OFFICE-1.png" alt="Shophouse Home Office" class="clickable-image" data-group="shophouse-interior-all" data-fullsrc="Image/B-HOME OFFICE-1.png">
                        <p class="image-caption text-center mt-2">បន្ទប់ការិយាល័យ | HOME OFFICE</p>
                    </div>
                    <div class="interior-image-container p-4">
                        <img src="Image/B-GIRL BEDROOM-3.png" alt="Shophouse Girl Bedroom" class="clickable-image" data-group="shophouse-interior-all" data-fullsrc="Image/B-GIRL BEDROOM-3.png">
                        <p class="image-caption text-center mt-2">បន្ទប់កូនស្រី | GIRL BEDROOM</p>
                    </div>
                    <div class="interior-image-container p-4">
                        <img src="Image/B-BOY BEDROOM-1.png" alt="Shophouse Boy Bedroom" class="clickable-image" data-group="shophouse-interior-all" data-fullsrc="Image/B-BOY BEDROOM-1.png">
                        <p class="image-caption text-center mt-2">បន្ទប់កូនប្រុស | BOY BEDROOM</p>
                    </div>
                </div>
            </section>
           <!-- 360 Degree View Section - Added to Shophouse Details Page -->
            <section id="panorama-section" class="max-w-7xl mx-auto px-4 py-8 bg-white shadow-lg rounded-xl text-center" data-aos="fade-up" data-aos-duration="1000">
                <h2 class="text-3xl font-semibold text-gray-800 mb-4">Experience 360° View / ទស្សនាទិដ្ឋភាព 360°</h2>
                <p class="text-gray-700 mb-6">Step inside and explore the immersive 360-degree view of this shophouse.</p>
                <div id="panorama-viewer"></div>
                <p class="mt-4 text-gray-600 text-sm">Drag your mouse to look around!</p>
            </section>
            <!-- End 360 Degree View Section -->

        </div>
    </main>

    <div class="fixed bottom-4 right-4 z-40">
        <a href="https://momento360.com/e/uc/YOUR_SHOPHOUSE_3D_MODEL_ID?utm_campaign=embed&utm_source=other&size=medium&display-plan=true" target="_blank" class="bg-[#7E252C] text-white py-3 px-6 rounded-full shadow-lg hover:bg-red-800 transition duration-300 ease-in-out text-xl font-semibold flex items-center justify-center">
            <i class="fa-solid fa-cube mr-2"></i> View 3D
        </a>
    </div>

    <div id="image-modal" class="modal-overlay">
        <img id="modal-image" src="" alt="Enlarged Image" class="modal-content">
        <button id="prev-image-button" class="modal-nav-button left"><i class="fa-solid fa-chevron-left"></i></button>
        <button id="next-image-button" class="modal-nav-button right"><i class="fa-solid fa-chevron-right"></i></button>
    </div>

    <footer class="bg-gray-900 text-white py-12 px-4 mt-auto">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 text-center md:text-left">
            <div>
                <h3 class="text-xl font-bold text-[#7E252C] mb-4">About TH Residence</h3>
                <p class="text-gray-300 text-sm leading-relaxed">
                    TH Residence is committed to delivering high-quality, modern living and business spaces in prime locations across Phnom Penh. We focus on innovative design, sustainable practices, and exceptional customer service.
                </p>
            </div>

            <div>
                <h3 class="text-xl font-bold text-[#7E252C] mb-4">Contact Us</h3>
                <ul class="space-y-3 text-sm">
                    <li class="flex items-center md:justify-start justify-center">
                        <i class="fa-solid fa-phone text-gray-400 mr-3"></i> 
                        <a href="tel:+85512345678" class="text-gray-300 hover:text-white transition duration-300"> +855 12 345 678</a>
                    </li>
                    <li class="flex items-center md:justify-start justify-center">
                        <i class="fa-solid fa-envelope text-gray-400 mr-3"></i> 
                        <a href="mailto:info@thresidence.com" class="text-gray-300 hover:text-white transition duration-300">thresidence.socialmedia@gmail.com</a>
                    </li>
                    <li class="flex items-start md:justify-start justify-center">
                        <i class="fa-solid fa-location-dot text-gray-400 mr-3 mt-1"></i> 
                        <span class="text-gray-300">Project DongKoa I, Phnom Penh, Cambodia</span>
                    </li>
                </ul>
            </div>

            <div>
                <h3 class="text-xl font-bold text-[#7E252C] mb-4">Useful Links</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="index.html" class="footer-link">Home page</a></li>
                    <li><a href="index.html#properties-section" class="footer-link">Properties</a></li>
                    <li><a href="index.html#about-us-section" class="footer-link">About Us</a></li>
                    <li><a href="#" class="footer-link">Privacy Policy</a></li>
                    <li><a href="#" class="footer-link">Terms of Service</a></li>
                    <li><a href="#" class="footer-link">FAQ</a></li>
                    <li><a href="#" class="footer-link">Sitemap</a></li>
                </ul>
            </div>

            <div>
                <h3 class="text-xl font-bold text-[#7E252C] mb-4">Newsletter</h3>
                <p class="text-gray-300 text-sm mb-4">Subscribe to our newsletter for the latest updates and offers.</p>
                <form class="flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0">
                    <input type="email" placeholder="Your email address" class="flex-grow p-2 rounded-md bg-gray-800 text-white border border-gray-700 focus:outline-none focus:ring-1 focus:ring-[#7E252C]">
                    <button type="submit" class="bg-[#7E252C] text-white p-2 rounded-md hover:bg-red-800 transition duration-300 ease-in-out">Subscribe</button>
                </form>
                
                <h3 class="text-xl font-bold text-[#7E252C] mb-4 mt-8">Follow Us</h3>
                <div class="flex justify-center md:justify-start space-x-6">
                    <a href="https://www.facebook.com/THresidences" target="_blank" aria-label="Facebook" class="social-icon text-3xl">
                        <i class="fa-brands fa-facebook"></i>
                    </a>
                    <a href="https://t.me/THResidence" target="_blank" aria-label="Telegram" class="social-icon text-3xl">
                        <i class="fa-brands fa-telegram"></i>
                    </a>
                    <a href="https://www.instagram.com/thresidences/" target="_blank" aria-label="Instagram" class="social-icon text-3xl">
                        <i class="fa-brands fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400 text-sm">
            &copy; <span id="current-year-footer"></span> TH Residence. All rights reserved.
        </div>
    </footer>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- Pannellum JavaScript for 360 viewer -->
    <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <script>
        // Dynamically set the current year in the footer
        document.getElementById('current-year-footer').textContent = new Date().getFullYear();
        AOS.init(); // Initialize AOS

        // Determine the base path for GitHub Pages and local development once
        const pathSegments = window.location.pathname.split('/');
        const isGitHubPages = pathSegments.length > 1 && pathSegments[1] === 'th-residence-website';
        const basename = isGitHubPages ? '/th-residence-website/' : ''; // Use empty string for local development

        // Log the basename to console for debugging
        console.log("Basename determined:", basename);

        // Declare carousel elements in a scope accessible to all carousel functions
        let shophouseCarousel; 
        let shophouseIndicatorsContainer; 
        let shophousePrevButton; 
        let shophouseNextButton; 

        // Function to update relative paths
        function updateRelativePaths(selector, attribute) {
            document.querySelectorAll(selector).forEach(element => {
                let currentPath = element.getAttribute(attribute);
                // Only modify if it's a relative path and not an absolute URL or anchor
                if (currentPath && !currentPath.startsWith('http') && !currentPath.startsWith('/') && !currentPath.startsWith('#')) {
                    element.setAttribute(attribute, basename + currentPath);
                } else if (currentPath && currentPath.startsWith('./')) {
                    // Handle relative paths like "./" for navigation
                    const cleanedPath = currentPath.substring(2); // Remove "./"
                    element.setAttribute(attribute, basename + cleanedPath);
                }
            });
        }

        // Apply path updates to various elements after the DOM is ready
        // This is crucial for local development where <base> tag is not used.
        // For GitHub Pages, the `basename` will prepend the correct path.
        document.addEventListener('DOMContentLoaded', () => {
            updateRelativePaths('img', 'src'); // For image sources
            updateRelativePaths('a', 'href'); // For anchor links (excluding # links)
            // Note: link[rel="stylesheet"] hrefs are handled by embedding CSS directly or using absolute CDN links
            
            // Initialize Shophouse Carousel when DOM is ready
            initializeShophouseCarousel(); 

            // Mobile Menu Toggle Logic
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mainNavigation = document.getElementById('main-navigation');
            const mobileMenuCloseButton = document.getElementById('mobile-menu-close-button');

            if (mobileMenuButton && mainNavigation) {
                mobileMenuButton.addEventListener('click', () => {
                    mainNavigation.classList.toggle('hidden');
                    mainNavigation.classList.toggle('flex'); 
                    mainNavigation.classList.toggle('flex-col'); 
                    mainNavigation.classList.toggle('items-center'); 
                    mainNavigation.classList.toggle('space-y-4'); 
                    mainNavigation.classList.toggle('fixed'); 
                    mainNavigation.classList.toggle('inset-0'); 
                    mainNavigation.classList.toggle('bg-white'); 
                    mainNavigation.classList.toggle('p-8'); 
                    mainNavigation.classList.toggle('z-[60]'); 
                    document.body.classList.toggle('modal-open'); 
                });
            }

            if (mobileMenuCloseButton) {
                mobileMenuCloseButton.addEventListener('click', () => {
                    mainNavigation.classList.add('hidden');
                    mainNavigation.classList.remove('flex', 'fixed', 'inset-0', 'bg-white', 'p-8', 'z-[60]');
                    document.body.classList.remove('modal-open'); 
                });
            }

            // Back to Top Button Logic
            const backToTopButton = document.getElementById('back-to-top');
            if (backToTopButton) { // Check if button exists before adding listener
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 300) { 
                        backToTopButton.style.display = 'block';
                    } else {
                        backToTopButton.style.display = 'none';
                    }
                });

                backToTopButton.addEventListener('click', () => {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth' 
                    });
                });
            }

            // --- Image Modal/Lightbox Logic with Carousel ---
            const imageModal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const prevButton = document.getElementById('prev-image-button');
            const nextButton = document.getElementById('next-image-button');
            
            // Select all clickable images, including carousel slides and grid images
            const clickableImages = document.querySelectorAll('.clickable-image'); 

            let currentImageGroup = [];
            let currentImageIndex = 0;

            function showImageInModal(index) {
                if (currentImageGroup.length > 0 && index >= 0 && index < currentImageGroup.length) {
                    modalImage.src = currentImageGroup[index];
                    currentImageIndex = index;

                    prevButton.classList.toggle('hidden', currentImageGroup.length <= 1);
                    nextButton.classList.toggle('hidden', currentImageGroup.length <= 1);
                }
            }

            clickableImages.forEach(image => {
                image.addEventListener('click', function() {
                    let groupImages = [];
                    let clickedImageSrc = this.getAttribute('data-fullsrc') || this.src;

                    if (this.closest('#linkhouse-carousel')) { // ID is still linkhouse-carousel in HTML
                        groupImages = shophouseImages.map(src => basename + "Image/" + src); // Ensure basename and Image/ prefix are applied
                    } 
                    else if (this.closest('.interior-image-container')) {
                        groupImages = Array.from(document.querySelectorAll('.interior-image-container .clickable-image')).map(img => basename + (img.getAttribute('data-fullsrc') || img.src.replace(basename, ''))); 
                    }
                    else if (this.closest('.plan-image-container')) {
                        groupImages = Array.from(document.querySelectorAll('.plan-image-container .clickable-image')).map(img => basename + (img.getAttribute('data-fullsrc') || img.src.replace(basename, ''))); 
                    }
                    else {
                        groupImages = [clickedImageSrc]; 
                    }
                    
                    currentImageGroup = groupImages;
                    currentImageIndex = currentImageGroup.indexOf(clickedImageSrc);

                    if (currentImageGroup.length > 0) {
                        showImageInModal(currentImageIndex);
                        imageModal.classList.add('open');
                        document.body.classList.add('modal-open'); 
                    }
                });
            });

            prevButton.addEventListener('click', (event) => {
                event.stopPropagation(); 
                if (currentImageGroup.length > 1) { 
                    const prevIndex = (currentImageIndex - 1 + currentImageGroup.length) % currentImageGroup.length;
                    showImageInModal(prevIndex);
                }
            });

            nextButton.addEventListener('click', (event) => {
                event.stopPropagation(); 
                if (currentImageGroup.length > 1) { 
                    const nextIndex = (currentImageIndex + 1) % currentImageGroup.length;
                    showImageInModal(nextIndex);
                }
            });

            imageModal.addEventListener('click', function(event) {
                if (event.target === imageModal) { 
                    imageModal.classList.remove('open');
                    document.body.classList.remove('modal-open'); 
                    modalImage.src = ''; 
                    currentImageGroup = []; 
                    currentImageIndex = 0; 
                }
            });

            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && imageModal.classList.contains('open')) {
                    imageModal.classList.remove('open');
                    document.body.classList.remove('modal-open');
                    modalImage.src = '';
                    currentImageGroup = [];
                    currentImageIndex = 0;
                }
            });
        }); // End DOMContentLoaded

        // --- Shophouse Main Carousel Logic --- (Changed from Linkhouse)
        const shophouseImages = [ // Changed array name
            "SHOPHOUSE_EVENING_VIEW022.jpg", // From previous user's code, assumed shophouse exterior
            "SHOPHOUSE_EVENING_VIEW022.jpg", // Placeholder, replace with more shophouse exteriors/interiors
            "B-LIVING ROOM-1.jpg", // Assuming this can be a generic shophouse interior
            "B-MASTER BEDROOM-3.png" // Assuming this can be a generic shophouse interior
        ];

        let currentShophouseDisplayIndex = 0; 
        let autoPlayIntervalShophouse; 

        function initializeShophouseCarousel() { 
            shophouseCarousel = document.getElementById('linkhouse-carousel'); 
            shophouseIndicatorsContainer = document.getElementById('linkhouse-indicators'); 
            shophousePrevButton = document.getElementById('linkhouse-prev'); 
            shophouseNextButton = document.getElementById('linkhouse-next'); 

            if (!shophouseCarousel || !shophouseIndicatorsContainer || !shophousePrevButton || !shophouseNextButton) {
                console.error("Shophouse carousel elements not found. Skipping initialization.");
                return;
            }

            shophouseCarousel.innerHTML = ''; 
            shophouseIndicatorsContainer.innerHTML = ''; 

            const shophouseCarouselSlides = [ 
                shophouseImages[shophouseImages.length - 1], 
                ...shophouseImages, 
                shophouseImages[0] 
            ];

            shophouseCarouselSlides.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = basename + "Image/" + src; 
                img.alt = `Shophouse Image ${index + 1}`; 
                img.classList.add('carousel-slide', 'clickable-image'); 
                img.setAttribute('data-fullsrc', basename + "Image/" + src); 
                shophouseCarousel.appendChild(img);
            });

            shophouseImages.forEach((_, index) => { 
                const dot = document.createElement('div');
                dot.classList.add('indicator-dot');
                dot.addEventListener('click', () => { 
                    showShophouseSlide(index + 1); 
                    resetAutoPlayShophouse(); 
                });
                shophouseIndicatorsContainer.appendChild(dot);
            });

            currentShophouseDisplayIndex = 1; 
            showShophouseSlide(currentShophouseDisplayIndex, false); 
            startAutoPlayShophouse(); 

            shophouseNextButton.addEventListener('click', nextShophouseSlide); 
            shophousePrevButton.addEventListener('click', prevShophouseSlide); 
        }

        function showShophouseSlide(index, smoothTransition = true) { 
            if (!shophouseCarousel) {
                console.error("shophouseCarousel is null in showShophouseSlide. Cannot update style.");
                return;
            }

            const totalOriginalSlides = shophouseImages.length; 
            const displaySlidesCount = totalOriginalSlides + 2; 

            shophouseCarousel.style.transition = smoothTransition ? 'transform 0.5s ease-in-out' : 'none';
            shophouseCarousel.style.transform = `translateX(-${index * 100}%)`;
            currentShophouseDisplayIndex = index; 

            if (shophouseIndicatorsContainer) { 
                let originalIndex = (index - 1 + totalOriginalSlides) % totalOriginalSlides; 
                Array.from(shophouseIndicatorsContainer.children).forEach((dot, i) => { 
                    dot.classList.toggle('active', i === originalIndex);
                });
            }

            if (index === displaySlidesCount - 1) { 
                setTimeout(() => {
                    showShophouseSlide(1, false); 
                }, 500); 
            } else if (index === 0) { 
                setTimeout(() => {
                    showShophouseSlide(totalOriginalSlides, false); 
                }, 500); 
            }
        }

        function nextShophouseSlide() { 
            showShophouseSlide(currentShophouseDisplayIndex + 1); 
            resetAutoPlayShophouse(); 
        }

        function prevShophouseSlide() { 
            showShophouseSlide(currentShophouseDisplayIndex - 1); 
            resetAutoPlayShophouse(); 
        }

        function startAutoPlayShophouse() { 
            stopAutoPlayShophouse(); 
            autoPlayIntervalShophouse = setInterval(() => { 
                showShophouseSlide(currentShophouseDisplayIndex + 1); 
            }, 5000); 
        }

        function stopAutoPlayShophouse() { 
            clearInterval(autoPlayIntervalShophouse); 
        }

        function resetAutoPlayShophouse() { 
            stopAutoPlayShophouse(); 
            startAutoPlayShophouse(); 
        }

        // Initialize Pannellum 360 viewer
        window.onload = function() {
            if (document.getElementById('panorama-viewer')) {
                const panoramaPath = basename + "Image/Panorama_TYPE_A.jpg"; // Reverted to 3D.jpg
                console.log("Attempting to load 360 panorama from:", panoramaPath); 
                pannellum.viewer('panorama-viewer', {
                    "type": "equirectangular",
                    "image": panoramaPath, 
                    "autoLoad": true,
                    "autoRotate": -2, 
                    "showControls": true,
                    "mouseZoom": true,
                    "compass": true,
                    "hfov": 100, 
                    "vaov": 70,  
                    "vOffset": 0,   
                    "onLoad": function() { 
                        console.log("Pannellum panorama loaded successfully!");
                    },
                    "onError": function(err) { 
                        console.error("Pannellum panorama failed to load:", err);
                        console.error("Failed to load panorama from URL:", this.getConfig().image);
                    }
                });
            }
        };
    </script>
</body>
</html>
